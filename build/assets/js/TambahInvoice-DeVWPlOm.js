import{r as i,W as B,j as a,a as H}from"./app-CyaN6xsP.js";import{A as L}from"./AdminLayout-PFMD-RUe.js";import{s as t}from"./EditBooking.module-DqgXu2wJ.js";import{B as C}from"./ButtonAdmin-DFHYROdf.js";import{X as A}from"./index.es-BmtGfkdq.js";import{S as E}from"./react-select.esm-7obwNL3l.js";import{R as p,C as l}from"./Row-CiQT7cFv.js";import{B as b}from"./Button-BgJxX_0z.js";/* empty css            */import"./index-CEILWtln.js";import"./emotion-unitless.esm-sScrWPmR.js";import"./setPrototypeOf-CL05xPcL.js";import"./ThemeProvider-DfRC6yqX.js";function la({booking:n,produks:P}){const[o,M]=i.useState(n),[d,h]=i.useState([]),[x,k]=i.useState(""),[c,N]=i.useState(1),[S,j]=i.useState(0),[f,J]=i.useState(P),{data:u,setData:g,post:K,put:_,processing:U,errors:R}=B({id:n.invoice.id,user_id:n.invoice.user_id,booking_id:n.id,tanggal:n.invoice.tanggal,status:n.invoice.status||"Unpaid",catatan:n.invoice.catatan||"",produk:d}),F=e=>{if(e.invoice&&e.invoice.items&&e.invoice.items.length>0){const r=e.invoice.items.map(s=>({id:s.produk.id,nama_produk:s.produk.nama_produk,jumlah:s.jumlah,harga:s.produk.harga,totalHarga:s.jumlah*s.produk.harga}));console.log(r),h(s=>[...s,...r])}else console.error("No items found in the invoice")};i.useEffect(()=>{F(n)},[n]);const v=f.map(e=>({value:e.nama_produk,label:e.nama_produk})),I=[{name:"Nama Produk",selector:e=>e.nama_produk},{name:"Jumlah",selector:e=>e.jumlah},{name:"Harga Satuan",selector:e=>e.harga.toLocaleString()},{name:"Total Harga",selector:e=>e.totalHarga.toLocaleString()},{name:"Aksi",selector:(e,r)=>a.jsxs(a.Fragment,{children:[a.jsx(b,{variant:"warning",onClick:()=>w(r),size:"sm",style:{fontSize:"5px",padding:"2px 5px"},children:a.jsx("box-icon",{name:"minus",type:"solid",color:"#fff",size:"18px"})}),a.jsx(b,{variant:"danger",onClick:()=>D(r),size:"sm",style:{fontSize:"5px",padding:"2px 5px",marginLeft:"10px"},children:a.jsx("box-icon",{name:"trash",type:"solid",color:"#fff",size:"18px"})})]})}];i.useEffect(()=>{const e=f.find(r=>r.nama_produk===x);j(e?e.harga*c:0)},[x,c]),i.useEffect(()=>{g(e=>({...e,produk:d}))},[d]);const q=()=>{const e=f.find(r=>r.nama_produk===x);if(e){const r=d.findIndex(s=>s.id===e.id);if(r!==-1){const s=d.map((m,z)=>z===r?{...m,jumlah:m.jumlah+c,totalHarga:(m.jumlah+c)*m.harga}:m);h(s)}else{const s={id:e.id,nama_produk:e.nama_produk,jumlah:c,harga:e.harga,totalHarga:e.harga*c};h([...d,s])}k(""),N(1),j(0)}},w=e=>{const r=d.map((s,m)=>m===e?{...s,jumlah:s.jumlah-1,totalHarga:(s.jumlah-1)*s.harga}:s).filter(s=>s.jumlah>0);h(r),console.log("Produk dikurangi atau dihapus pada index:",e)},D=e=>{h(r=>{const s=[...r];return s.splice(e,1),console.log("Produk dihapus pada index:",e),s})},T=e=>{e.preventDefault(),_(route("admin.booking.updateInvoice",{booking:n.id}),{preserveScroll:!0,data:u,onSuccess:()=>{console.log("Invoice updated")}}),console.log("Updated booking data:",u)},y=e=>{const{name:r,value:s}=e.target;g({...u,[r]:s})};return a.jsxs(L,{title:"MANAJEMEN BOOKING",children:[a.jsxs("div",{className:t["form-wrapper"],children:[a.jsx("h1",{className:t["title-form"]+" my-3",children:"Data Booking"}),a.jsxs("form",{action:"#",id:"form",className:t.form,children:[a.jsxs(p,{className:"justify-content-md-center mb-3",children:[a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"nama",children:"Nama Customer"}),a.jsx("input",{type:"text",value:o.user.nama,autoComplete:"off",required:!0,className:t.input,disabled:!0})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"jenis_layanan",children:"Jenis Layanan"}),a.jsx("input",{type:"text",value:o.jenis_layanan.jenis_layanan,autoComplete:"off",required:!0,disabled:!0,className:t.input})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"merk",children:"Merk Motor"}),a.jsx("input",{type:"text",value:o.katalog.merk+" "+o.katalog.model,autoComplete:"off",required:!0,disabled:!0,className:t.input})]})]}),a.jsxs(p,{className:"justify-content-md-center mb-3",children:[a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"tahun_pembuatan",children:"Tahun Pembuatan"}),a.jsx("input",{type:"text",value:o.tahun_pembuatan,autoComplete:"off",required:!0,disabled:!0,className:t.input})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"nomor_polisi",children:"Nomor Polisi"}),a.jsx("input",{type:"text",value:o.nomor_polisi,autoComplete:"off",required:!0,disabled:!0,className:t.input})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"km_kendaraan",children:"Kilometer Kendaraan"}),a.jsx("input",{type:"text",value:o.km_kendaraan,autoComplete:"off",required:!0,disabled:!0,className:t.input})]})]}),a.jsxs(p,{className:"justify-content-md-center mb-3",children:[a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"jadwal_booking",children:"Jadwal Booking"}),a.jsx("input",{type:"date",value:o.jadwal_booking,autoComplete:"off",required:!0,disabled:!0,className:t.input})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"status",children:"Status"}),a.jsx("input",{type:"text",value:o.status,autoComplete:"off",required:!0,disabled:!0,className:t.input})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"catatan",children:"Catatan Tambahan"}),a.jsx("textarea",{rows:"4",value:o.catatan,autoComplete:"off",required:!0,disabled:!0,className:t.catatan})]})]})]})]}),a.jsx("hr",{className:"my-5",style:{border:"2px solid #f16211",color:"#f16211"}}),a.jsxs("div",{className:t["form-wrapper"],children:[a.jsx("h1",{className:t["title-form"]+" my-3",children:"Form Invoice"}),a.jsxs("form",{action:"#",method:"post",id:"form",onSubmit:T,className:t.form,children:[a.jsxs(p,{className:"justify-content-md-center mb-3",children:[a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"jenis_layanan",children:"Status Pembayaran"}),a.jsxs("select",{value:u.status,className:t.select,name:"status",id:"status",onChange:y,children:[a.jsx("option",{disabled:!0,value:"",children:"Pilih Status Pembayaran"}),a.jsx("option",{value:"Unpaid",children:"Unpaid"}),a.jsx("option",{value:"Paid",children:"Paid"})]})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"tanggal",children:"Tanggal"}),a.jsx("input",{type:"date",name:"tanggal",id:"tanggal",className:t.input,value:u.tanggal,onChange:e=>g({...u,tanggal:e.target.value})})]}),a.jsxs(l,{md:4,children:[a.jsx("label",{className:t.label,htmlFor:"catatan",children:"Catatan Tambahan"}),a.jsx("textarea",{rows:"4",name:"catatan",id:"catatan",value:u.catatan,autoComplete:"off",className:t.catatan,onChange:y})]})]}),a.jsx("h2",{className:t["title-form"]+" my-3",children:"Tambah Produk"}),a.jsxs(p,{className:"justify-content-md-center mb-3",children:[a.jsxs(l,{md:6,children:[a.jsx("label",{className:t.label,htmlFor:"produk",children:"Nama Produk"}),a.jsx(E,{id:"produk",options:v,value:v.find(e=>e.value===x),onChange:e=>k(e.value),placeholder:"Pilih Produk"})]}),a.jsxs(l,{md:2,children:[a.jsx("label",{className:t.label,htmlFor:"jumlah",children:"Jumlah"}),a.jsx("input",{type:"number",className:t.input,value:c,onChange:e=>N(Number(e.target.value)),min:"1",required:!0})]}),a.jsxs(l,{md:2,children:[a.jsx("label",{className:t.label,htmlFor:"harga",children:"Harga"}),a.jsx("input",{type:"text",name:"harga",id:"harga",disabled:!0,className:t.input,value:S,required:!0})]}),a.jsxs(l,{md:{span:2},className:"text-center",children:[a.jsx("label",{className:t.label,htmlFor:"aksi",children:"Aksi"}),a.jsx(b,{title:"Tambah Produk",onClick:q,style:{backgroundColor:"#f16211",border:"none",padding:"5px 5px 2px",marginTop:"5px"},size:"sm",children:a.jsx("box-icon",{name:"plus",color:"#fff",size:"18px"})})]})]}),a.jsx(p,{children:a.jsx(l,{children:a.jsx(A,{columns:I,data:d,striped:!0,responsive:!0,hover:!0})})}),a.jsxs(p,{className:"mb-3",children:[a.jsx(l,{md:6,children:a.jsx(C,{variant:"secondary",style:{backgroundColor:"rgba(183, 182, 182, 0.8)",fontSize:"20px"},children:a.jsxs(H,{href:route("admin.booking.index"),style:{textDecoration:"none",color:"inherit",display:"flex",alignItems:"center"},children:[a.jsx("box-icon",{name:"arrow-back",color:"#fff"})," ",a.jsx("span",{style:{marginLeft:"10px"},children:"KEMBALI"})]})})}),a.jsx(l,{md:{span:2,offset:4},children:a.jsxs(C,{style:{background:"linear-gradient(90deg, #f16211 -14.33%, #e59a6f 85.67%)",fontSize:"20px"},type:"submit",children:[a.jsx("box-icon",{name:"save",type:"solid",color:"#fff"})," ",a.jsx("span",{style:{marginLeft:"10px"},children:"SUBMIT"})]})})]})]})]})]})}export{la as default};
